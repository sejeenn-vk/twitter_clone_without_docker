# Описание проекта "Twitter-clone"
Проект представляет собой backend-составляющую (API для twitter-подобного приложения) с 
возможностью постить твиты с картинкой, ставить лайк, удалять лайк, просматривать данные 
о себе и других пользователях, подписываться на других пользователей и просматривать ленту твитов.

Лента твитов отсортированных в порядке убывания по популярности от пользователей, которых 
пользователь читает.

Требования регистрации пользователя нет: это корпоративная сеть и пользователи будут 
создаваться не нами. Но нам нужно уметь отличать одного пользователя от другого.
Аутентификация пользователей осуществляется через **токен "api-key" в header**.

## Используемые инструменты
* **Python** (3.12);
* **FastApi** (асинхронный веб-фрэймворк);
* **PostgreSQL** (СУБД);
* **SQLAlchemy** (управление базами данных для Python);
* **Pydantic** (верификация данных);
* **Loguru** (логгирование);
* **Pytest** (тесты);
* **Nginx** (связующий сервер между FastAPI приложением и статическими данными - фронтендом).

## Для запуска проекта потребуются:  
Необходимо установить на компьютере систему управления базами данных Postgresql и 
вебсервер Nginx. На Arch-подобных системах это:

```commandline
sudo pacman -S postgresql nginx
```

### Postgresql
После установки Postgresql необходима его первоначальная настройка и инициализация базы
данных, входим в командную оболочку postgres:

```commandline
sudo -iu postgres
```

Инициализируем базу данных:

```commandline
initdb --locale=C.UTF-8 --encoding=UTF8 -D /var/lib/postgres/data --data-checksums
```

После инициализации базы данных выходим из оболочки postgres сочетанием клавиш Ctrl+D и 
запускаем сервер баз данных: 

```commandline
sudo systemctl start postgresql.service
```

Теперь можно войти в командную оболочку среды и создать базу данных и пользователя, 
для данного приложения.

```commandline
sudo -u postgres psql
```

После входа в командную систему управления базами данных создаем базу и пользователя:

```commandline
create database twitter_db;
create user twitter_user with password 'very_hard_password' superuser;
```

Соответственно, для тестов так же потребуется база данных и пароль. Тоже создаём.
После чего эти данные можно будет подставить в файл **.env** для управления базой данных
непосредственно из приложения.

### Nginx
Для работы со статикой требуется Nginx, именно он будет раздавать фронтенд (то что мы видим
в браузере). Для его настройки нужно написать (отредактировать) конфигурационный файл nginx.conf
Который находится /etc/nginx/nginx.conf, мой пример конфига:  

![](/screenshots/nginx_conf.png)

Скопировать директорию static из проекта в директорию по умолчанию для root.
Прописать proxy_pass который будет взаимодействовать с приложением FastAPI.
Создать директорию для картинок, куда они будут сохраняться. 
Сделать разрешения для этой директории:

```commandline
mkdir /usr/share/nginx/static/images
chmod 777 /usr/share/nginx/static/images
```

После копирования файлов, создания директории для картинок и выдача ей 
разрешений на полный доступ к этой директории всех (только к этой директории!), 
можно запускать сервер nginx:

```commandline
sudo systemctl start nginx.service
```

### Редактируем .test.env
В корне проекта есть файл **.test.env** на основе его нужно создать файл **.env**
и скопировать в директорию src. Прописать имя базы данных, имя пользователя и пароль
для доступа к базе данных, как-то так:

![](/screenshots/env.png)

### Первоначальный запуск приложения
Открываем файл main.py и смотрим чтобы было раскомментироанно удаление, создание таблиц и 
наполнение их данными:

![](/screenshots/main.png)

Теперь можно запускать, как из среды Pycharm, нажатием на кнопку Run, либо из 
командной строки:

```commandline
fastapi run src/main.py --port=8000
```

Если всё нормально, то в браузере, по адресу http://0.0.0.0 можно будет увидеть результат
работы приложения:  
![](/screenshots/result.png)  

Если у вас нет изображения под самым верхним твитом, то значит у вас просто нет этого 
изображения в директории /usr/share/nginx/static/images
Сохраните туда любое изображение с именем 111.jpg  
Обновите страницу браузера и изображение появится под этим твитом.
# Описание проекта "Twitter-clone"
Проект представляет собой backend-составляющую (API для twitter-подобного приложения) с 
возможностью постить твиты с картинкой, ставить лайк, удалять лайк, просматривать данные 
о себе и других пользователях, подписываться на других пользователей и просматривать ленту твитов.

Лента твитов отсортированных в порядке убывания по популярности от пользователей, которых 
пользователь читает.

Требования регистрации пользователя нет: это корпоративная сеть и пользователи будут 
создаваться не нами. Но нам нужно уметь отличать одного пользователя от другого.
Аутентификация пользователей осуществляется через **токен "api-key" в header**.

## Используемые инструменты
* **Python** (3.12);
* **FastApi** (асинхронный веб-фрэймворк);
* **Docker** and **Docker Compose** (контейнеризация);
* **PostgreSQL** (СУБД);
* **SQLAlchemy** (управление базами данных для Python);
* **Pydantic** (верификация данных);
* **Loguru** (логгирование);
* **Pytest** (тесты);
* **Nginx** (связующий сервер между FastAPI приложением и статическими данными - фронтендом).

## Сборка и запуск приложения
0. Подготавливаем сервер для загрузки проекта (регистрация на хостинге, создание виртуальной 
   машины Linux, вход в нее по ssh). Войдя на удаленный компьютер - устанавливаются необходимые 
   компоненты (программы):
   docker, docker-compose, git, openssh.
   Создаётся публичный ssh-key:
   ```
   ssh-keygen -t rsa
   ```
   Открываем этот ключ и копируем:
   ```
   cat ~/.ssh/id_rsa.pub
   ```
   Скопированный ключ регистрируем на gitlab. Дабы иметь доступ для клонирования проекта.
1. Скачиваем содержимое репозитория в отдельную папку:
    ```
    git clone git@gitlab.skillbox.ru:evgenii_vorontsov_1/python_advanced_diploma.git
    ```
2. Копируем файл "**.test.env**" в директорию src с именем "**.env**", со своими параметрами
    необходимыми для подключения к базе данных Postgres.


3. Собираем и запускаем контейнеры с приложением. В терминале в общей директории (с файлом "docker-compose.yml") 
вводим команду:
    ```
    sudo docker-compose up -d
    ```
   Если запуск завершился неудачей, например из-за санкций докер недоступен в России, то необходимо
   выполнить следующие действия:
   создать файл ~/.config/docker/daemon.json такими данными:
   ```
   {"registry-mirrors": ["https://dh-mirror.gitverse.ru"]}
   ``` 
   перезапустить docker:
   ```
   sudo systemctl reload docker
   ```
   После первого запуска приложения необходимо закомментировать следующий код в файле src/main.png:
   ![](/screenshots/main.png)
   Иначе после перезапуска приложения база данных будет перезаписана и данные не сохранятся.
   Если удаленный компьютер настроен правильно, то запуск приложения укладывается в несколько команд:
![](/screenshots/docker_up.png)
   Результат выполнения должен отразиться по адресу, предоставленному провайдеру, в моём случае это
   http://94.241.170.218/
![](/screenshots/web_page.png)

4. Для тестирования приложения нужно зайти "внутрь" контейнера путем запуска команды:
    ```
    docker exec -it <container_id> /bin/bash 
    ```
   и выполнить команду:
   ```
    pytest -v
    ```
   Узнать id контейнера можно командой:
   ```
    docker ps 
    ```
   Нас интересует id контейнера для python_advanced_diploma-app:
   ![](/screenshots/docker_ps.png)

   Результат выполнения тестов:
   ![](/screenshots/pytest.png)
5. Так как приложение выполняется в качестве "демона" (в фоновом режиме), то мы не можем его завершить 
   путем нажатия Ctrl+C. Нужно зайти в директорию с проектом и ввести команду
    ```
    docker compose stop 
    ```
   ![](/screenshots/docker_stop.png)